#!/usr/bin/env node --use_strict
/* eslint-disable no-console */

// This creates pot (template) files.
const gmd = require('gettext-markdown');
const fs = require('fs');
const path = require('path');
const shell = require('shelljs');

const guidesDir = path.join(__dirname, '../guides');
const localeDir = path.join(__dirname, '../locale');
const templateDir = path.join(localeDir, '/templates/LC_MESSAGES/contents/')

// Get guide md files.
const files = fs.readdirSync(__dirname + '/../guides/');
const mdFiles = files.filter(file => path.extname(file) === '.md');

shell.exec(`mkdir -p ${templateDir}`);

for (file of mdFiles) {
  const pot = gmd.md2pot(`${guidesDir}/${file}`);
  const outputFile = `${path.basename(file, '.md')}.pot`;
  const output = `${templateDir}${outputFile}`;

  fs.writeFile(output, pot, (e) => {
    if (e) {
      process.stdout.write(file + ' => ');
      process.stdout.write(colors.red('WRITE FAILED') + '\n');
      console.error(e);
    } else {
      process.stdout.write(file + ' => ');
      process.stdout.write(output + '\n');
    }
  });
}

